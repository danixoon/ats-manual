# ATS-Manual

Система управления кроссовыми данными автоматической телефонной станции.

## Системные требования

- ОС `Windows 7` / `Windows Server 2008 R2` и выше.
- Библиотека `Microsoft NetFramework` версии `3.5` и выше.
- База данных `SQL Server 2014` и выше.

## Загрузка

Последний релиз [здесь](/че).

## Установка
### База данных

**Установка на `Windows Server 2008 R2` без интернета**

_Включение компонента `.NET Framework 3.5.1`_

На компьютере открывается **Диспетчер сервера**, переход в раздел **Компоненты** и выбор пункта **Добавить компоненты**. Из списка в открывшемся окне выбирается элемент **Возможности .NET Framework 3.5.1**, нажатие на кнопку **Установить** и штатная установка.

_Установка `SQL Server 2014` с пропуском пунктов, требующих подключение к интернету_

Запускается файл распаковщика установщика **SQL Server 2014** (файл полученный с официальной страницы загрузки им и является) и штатно исполняется. В директории распакованного установщика запускается терминал (на `Windows` -- **SHIFT** + **Правая кнопка мыши**, выбор **Открыть окно команд**). Выполняется следующая команда:

`setup.exe /ACTION=install /SKIPRULES=InternetConnectionToNETFX4DownloadSite RS_IsDotNet3_5Installed`

В дальнейшем штатно производится установка. (Далее, далее, далее, без дополнительных действий).

**Настройка экземпляра `SQL Server 2014`**

Для начала необходимо разрешить подключение к серверу извне.

После установки в меню **Пуск** появится приложение **Диспетчер конфигурации SQL Server 2014**. Переход в пункт **Сетевая конфигурация SQL Server** -> **Протоколы для SQLExpress**. В списке выбирается параметр **TCP/IP**, в появившимся окне, в разделе **Протокол** меняется значение **Включено** на `Да`, в разделе **IP-адреса**, в группе **IPAll** (самая последняя) в качестве **TCP-порт** устанавливается `1433` (либо другой необходимый, это стандартный). Следующее пункт **Ок**, переход в **Службы SQL Server** и перезапуск службы **SQL Server**.

Следующим шагом необходимо разрешить подключение к серверу через пару логин/пароль.

В меню **Пуск** Открывается **SQL Server 2014 Management Studio**. Производится подключение к экземпляру сервера со стандартной **проверкой подлинности Windows**. После подключения, появится активный сервер (SQLEXPRESS), **правая кнопка мыши** -> **Свойства** -> **Безопасность** и выбор пункта **Проверка подлинности SQL Server и Windows**. Жмётся кнопка **Ок**.
 
После, создать имя пользователя для подключения к базе данных.

В выбранном сервере перейти в **Базы данных**, создать новую базу данных с названием, например, `ATSManual`. Вернуться в корень сервера, перейти в пункт **Имена входа** и создать новое имя входа. Ввести имя пользователя бд, выбрать проверку **подлинности SQL Server** и указать пароль подключения. Убрать галочку **Требовать использование политики паролей**. В нижнем выпадающем списке выбрать базу по умолчанию (`ATSManual`, в случае созданной в руководстве). Перейти в раздел **Сопоставление пользователей**, в списке отметить нужную базу данных и в нижнем списке отметить членства `db_datareader`, `db_datawriter`, `public`. Применить изменения.

И теперь заполнить базу данных.

В меню выбрать пункт **Создать запрос** и прописать содержимое [файла](/ATSManual/create.sql). Если у базы данных отличное от `ATSManual` имя, изменить первую строку на соответствующую.

```sql
USE [ИМЯ_БАЗЫ_ДАННЫХ]
```

Выполнить запрос, создав структуру базы данных.

### Приложение

Разархивировать архив с приложением в рабочую папку. В файле `config.ini` (если отсутствует -- создать) прописать содержимое:

```ini
DATABASE_CONNECTION_STRING=Data Source=IP-АДРЕС,ПОРТ;Network Library=DBMSSOCN;Initial Catalog=ИМЯ_БАЗЫ_ДАННЫХ;Integrated Security=False;User ID=ИМЯ_ПОЛЬЗОВАТЕЛЯ_БД;Password=ПАРОЛЬ_ПОЛЬЗОВАТЕЛЯ_БД;Connect Timeout=15;Encrypt=False;TrustServerCertificate=True;ApplicationIntent=ReadWrite;MultiSubnetFailover=False
```

Запустить файл `ATSManual.exe`. При корректной конфигурации приложение подключится к базе данных без ошибок и будет штатно работать.
